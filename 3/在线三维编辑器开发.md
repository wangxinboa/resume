# 在线三维编辑器开发

## 简介

&emsp;最主要的工作，其他的工作，如模型拉取，如果花费的时间较多的话，就放下，以编辑器开发为主。(就放下了一次，然后我知道了模型组买一个模型要七八百)。

&emsp;页面以 react 为基础，三维以 babylon.js 为基础实现的在线三维编辑器。按照计划是分为两个步骤。

&emsp;初期的话，就是调用 babylon.js 自身的接口函数，完成从编辑器到业务的流程，尽可能的发挥出 babylon.js 即可。虽然说是两三个月勉勉强强赶工出来的，有不少问题，用起来也不方便，但是也初步完成了，可以让美术生产模型，并且开始投入到懂车帝和其他一些展馆模型的业务中。(੭ˊ꒳​ˋ)੭ ​​​

&emsp;后期的话，就开始深入 babylon.js 的源码，对其进行魔改，针对业务，结合美术人员的操作进行不断完善，甚至推倒重建。

## 实现方式

1. ui 方面主要是~~抄袭~~借鉴了 play canvas 编辑器的样式。

2. 初期比较核心的是属性编辑，我主要是根据属性值的类别写了对应的组件，主要是文字展示、数字编辑、贴图编辑、布尔值编辑、颜色编辑、类型选择。然后再写一个组合的组件，根据输入的面板数组信息生成编辑面板。

&emsp;其中比较麻烦的是数字编辑，主要是~~抄袭~~借鉴了 lil-gui 的 NumberController ，在此基础上进行一定程度的魔改。

&emsp;主要还是以前端为主，需要注意的话，之前是使用了 vue2，但是发现，由于 vue2 的响应式实现原理是 Object.defineProperty ，如果引入的第三方框架内的对象已经有 Object.defineProperty 的话， vue2 就会失效，而不幸的是 babylon.js 内部代码的 mesh 对象存在这种情况，无法实现响应式。之后又尝试了 vue3 ， vue3 的话，使用了 Proxy 代理，不知道什么原因，会导致 babylon.js 的渲染帧率大幅度下降。最后还是确定使用 react，数据够纯，不会对变量有影响。

3. 模型导入、模型拾取、材质导入、材质预览使用的都是 babylon.js 自身的接口函数实现。一边看 babylon.js 文档和源码学习，一边实现。

## 小结

&emsp;原来按照计划，是慢慢的对 babylon.js 的源码进行修改，下一步的话，是模型加载，然后是材质对象。但是身体撑不住了，结石生病，真的感觉要死了，整个人都倒了，交接好之后，回家休息。申请离职。

