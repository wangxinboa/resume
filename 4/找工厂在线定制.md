# 找工厂在线定制

## 简介

&emsp;1688 业务中的哇噢定制，分为两部分:

1. 展示给用户看的定制操作页面，app移动端和PC端浏览器都有。
2. 内部图片和模型等素材管理的后台PC端浏览器页面。

## 定制操作

&emsp;app 移动端中和浏览器网站网上，在部分商品页面内，可以进行文字图像的自定义添加。按照项目的设计，会根据不同类别的场景有不同的定制页面进行操作，根据实际需求，不断添加需要的场景，我参与的工作如下:

1. 迭代完善加图加字场景的部分操作组件，如文字操作、图片编辑上传，并且对接原本的 canvas ，并使用自定义 hook 抽离逻辑，添加对应的桌面组件。
2. 添加五指鼠标垫的定制场景操作，完成对应的 canvas 绘制。

### 加图加字组件迭代

&emsp;[简单的展示移动端线上加图加字定制操作视频链接(这是在线上 app 里有的，不是内部数据哦。因为是直接部署在 git 上，所以加载可能较慢）](https://wangxinboa.github.io/react_project/resume/4-1/mp4_1.mp4)。

&emsp;这时我还是刚开始接触定制业务，更多是从 rax 组件方面入手，了解渲染定制方面的操作。

&emsp;线上移动端选择文字或图片组件

<img src='https://wangxinboa.github.io/react_project/resume/4-1/img1.jpeg' width="200" />

&emsp;线上移动端图片操作组件

<img src='https://wangxinboa.github.io/react_project/resume/4-1/img2.jpeg' width="200" />

&emsp;线上移动端文字编辑组件

<img src='https://wangxinboa.github.io/react_project/resume/4-1/img3.jpeg' width="200" />

&emsp;线上 pc 端在 1688 官网，选择杭州哇噢定制供应链管理有限公司，随便找一个商品，进入场景页面，在右侧的批发面板中找到加图加字，点击选中之后，再点击出现的上传加印图片，就有相关的操作组件出现。[案例商品地址](https://detail.1688.com/offer/833760513441.html)

&emsp;线上 pc端选择文字或图片组件

<img src='https://wangxinboa.github.io/react_project/resume/4-1/img4.jpg' width="400" />

&emsp;线上 pc端图片操作组件

<img src='https://wangxinboa.github.io/react_project/resume/4-1/img5.jpg' width="400" />

&emsp;线上 pc端文字编辑组件

<img src='https://wangxinboa.github.io/react_project/resume/4-1/img6.jpg' width="400" />

&emsp;组件之间的交互使用类 eventemitter 的方式进行通知，如，点击文字，就会通知文字编辑组件出现，并且通知 canvas 绘制组件出现文字相关的元素渲染；在文字编辑组件中，输入文字，就会通知 canvas 绘制组件更新文字内容。

### 五指鼠标垫

&emsp;这算是我正式开始独立触及完整的定制场景，较为简单，而且是一个内部商品的业务，想来按计划，也是为之后场景的添加做准备吧。

&emsp;场景只有移动端，是对一张 2111 * 816 的鼠标垫图片进行二维码图片和文字的添加，大部分区域都是确定的，只有右下角一小块区域需要进行定制操作。

&emsp;一开始展示右下角编辑区域，按照比例值从原始的图片中截取作为背景图展示，然后调用接口进行图片上传，成功返回图片中的二维码的话，实时展示在对应的区域，最多同时展示两个。还有文字添加，一张图的时候，在图片右侧可以展示两行，每行最多6个字。两张图或者无图的时候，展示一行最多15个字，并且根据文字的多少调整字体大小，字数越多，字体越小，防止过长超出屏幕。确定编辑完成之后，跳到新的组件横屏展示的鼠标垫全部内容。

&emsp;不过我现在上 app 看了下，现在商品已经下架了，有点小遗憾啊。

## 素材管理

&emsp;在 app 线上的定制操作中，可以看到有的商品没有定制操作，有定制操作的话，会根据不同的商品，展示不同的商品白底图，而且商品白底图的可编辑区域也不同。定制选择图片编辑的话，存在默认的，不同类别的图片，这些都是在后台操作的。

&emsp;后台以下配置管理:

1. 模型配置
2. 定制流程配置
3. 图片素材管理

&emsp;由于是内部数据操作，所以只有简单文字描述。

### 模型配置

&emsp;使用 StepForm 组件进行以下几个步骤的模型添加

1. 首先是作为商品白底图的 svg 图片添加，需要解析 svg 信息，提取出约定好的可编辑区域信息，并且转成 png 图片文件，然后将处理后的 svg 和 png 文件上传，完善相关表单信息。
2. 之后是对应的三维模型上传，之后使用 three.js 在 canvas 中渲染展示。模型是事先设计好的，会根据对应 svg 图片定制的信息，在对应区域展示，与二维图片的定制保持一致。并非必须加上，可以跳过。
3. 后面两个步骤是 AI 渲染和前端渲染，不过暂时没有确定，所以是空白无操作，可以直接跳过。

&emsp;然后还有单独的按钮，可以将配置的模型和需要定制的商品种类关联起来。

&emsp;这是新增模型配置的操作，新增之后有可供查看的 ProTable 表格。

###  定制流程配置

&emsp;只是单独创建一个表示定制流程的 ProForm 表单，然后和之前创建模型绑定起来。

###  图片素材管理

&emsp;首先是编辑主题，即加图操作中的图片类别信息，使用 antd 的 Table 组件，然后结合 form 表单，实现类别的新增和可编辑，再加上 dnd-kit 实现拖拽，方便调整顺序。其实就是将 antd 的可编辑单元格和拖拽手柄列两个案例结合了一下。

&emsp;之后是基本的图片信息表单，上传图片之后，填入表单信息，挂到已经创建好的类别下。

&emsp;还有编辑素材顺序，决定了在线上 app 中，每个类别下展示图片素材的顺序。

&emsp;可供查看所有图片素材的 ProTable 表格，以及相应的筛选操作。

&emsp;需要注意的是，为了配合后端，调整顺序时，每次上传的更新后的信息有上限，所以使用 Promise 包裹了一层回调执行的接口请求函数，只有当所有数据都上传完毕了，才会 resolve 执行成功，只要有一次执行失败了，就直接 reject。


