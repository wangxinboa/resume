# 城市大脑天擎平台

## 简介

&emsp;看样子是一个比较大的项目，主要是我主管的老板负责的，一位 P9。我被调过去完成相关需求。

&emsp;主体的代码是我主管的老板写的，据他自己说，他不是前端出身的，半路出家学了一下。用的是 react + typescript 技术栈，具体的代码情况的话， react 完整的页面数据通信是没有的，简单的 props 传递一下，或者直接从 window 上取。 路由的话， window.loacation.href 结合 react-router-dom 一起使用。

&emsp;首先，主要是登陆注册页面，这个登陆成功之后是通过 window.loacation.href 实现页面跳转。然后跳入到一个模板中，左边是模块目录，选择之后出现对应的主题内容。这方面的路由是 react-router-dom 实现。开发的话，其实就是为这个模板不断添加模块目录和对应的内容。

&emsp;我参与的工作如下:

1. 修复现有问题
2. 将[人工智能标注](https://github.com/WxbOfficial/resume/blob/main/2/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%A0%87%E6%B3%A8.md)中的图像标注操作添加到其中。

## 修复现有问题

&emsp;具体情况如下: 

1. 比较简单的一类问题，就是将 cookie 中的一段信息，添加到 axios 的 header 中。值得一提的是，虽然用了 axios ，但是并没有使用拦截对请求信息进行统一，有些是单独的进行请求，有些是使用装饰器进行请求(看情况我主管的老板大概是边学边做的)，需要分别的添加。还有一个就是 websocket 的 header 添加，抄了一下[作业](https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api)发现，由于 websocket 自带的局限性，只能在固定的属性上添加，所以让后台配合的改了一下代码。

2. 一个很简单的变量检查，因为没有考虑 undefined 类型的情况，所以会导致页面崩溃，判断一下即可。这里感觉 typescript 是白给了。

3. 一些 css 的简单修改，涉及到组件自适应和 ui 的展示性。这个就更无语了，高度塌陷、内部节点宽高使用 vw 和 vh 、直接固定像素，不考虑自适应，最后是麻木了。

4. ant-design 的 select 组件的问题，列表滚动的时候出现列表数据错乱，根据官方案例改一下就行。

5. xterms 的命令行现实问题，网上抄了一下作业发现需要和后代的终端进行同步，让后代同步改一下相应的代码。

6. 有一个是人工智能对话的页面，调用 react-chat-elements 组件显示对话，修复不能自动到底的问题(覆盖了一下原来组件的 css)；需要修改用户输入问题的 ui；原来是固定的三个聊天记录，改成一开始一个，然后可以增删，最多三个，最少一个，要求自适应。比较没想法的是，使用 useRef 保存的机器人对象。原来的代码将聊天信息机器人和接口写到一个组件内部，需要用 useRef 拿到机器人聊天对话组件内的函数，输入用户的问题，对聊天信息进行更新。但是这样的话，就不方便对其进行增加了( useRef 好像只能一开始在组件内就确定好，想要调用函数创建编译报错了)。最后我也在这个基础上进行骚操作，还是一开始就有三个 useRef ， useState 新建了两个数组，一个用于保存现在展示的组件，一个用于保存没展示的，增删其实就是将三个 useRef 在这两个数组中进行转移，效果是实现了，没什么问题。(比较好的方法应该是将机器人抽离出来，独立作为一个对象，要用了就 new 一个放到数组里。将错就错吧，这种问题是本来是需要后续花时间沟通完善)

7. 原本的平台名称好像是叫地雀，后来改成了天擎，其中有一些表格的组件(二次封装了 ant-design 的 table 组件)以及相关的变量名开头就是 dq/Dq ，后来全部都要改成 tq/Tq。虽然没什么问题，全文件夹大小写区分搜索替换的时候注意一下就行。

8. 还有一些简单的增删改查的小需求添加以及优化。

&emsp;修复问题的时候，有感觉上的不适应，毕竟很难想象大厂部门级的项目还能这样，不过也没什么实质上的麻烦障碍。真正比较头痛的是，我是比较匆忙，被借来参与这个相关项目的，没有磨合，很多信息不清楚，项目的主导人感觉也是很急躁，代码审评的时候就会比较难受。(而且这个项目我有种就是为了应付更上面的领导的感觉，质量很差，又很臃肿。)


## 集成图像标注操作

&emsp;因为是自己写的代码，所以集成没什么大的问题。简单说一些需要注意的吧。

1. 使用的是原来的后台接口，由于不同的接口，所以使用 axios.create ，创建一个实例进行区分，单独拦截接口信息。但是登陆接口没统一，所以先直接使用固定的账号密码进行了登录，保存用户信息。用户信息过期的话，就使用 reload 刷新页面，重新登陆。

2. css 上的问题。将模块嵌入的时候发现页面和原来的不一致，结果发现有的 css 样式被覆盖了，最后在子模块下再次进行 css 样式覆盖。还有图标展示的问题，我习惯是直接导入 iconfont 的 css 实现字体图标，但是主项目上的图标是直接使用 ant-design 的现成图标，最后是仿照原来 vue 项目使用 background-image 加载图片显示图标。还有一个是我个人的习惯问题，我一般习惯于在 body 上定义 font-size=100px， 然后下面的 css 尺寸使用 rem ，(这个是为了方便在不同尺寸的屏幕上实现自适应，源于我第一家公司的智慧城市类大屏项目)，主项目的尺寸是 px ，就得改一下，实现统一。(基本就是 css 的使用规范不统一引起的问题。有些是主项目的 css 确实不行；有些是因为就是我在写人工智能标注的时候，没注意到这个情况)

3. 由于主项目是没有 store 的，所以单独的在模块上添加 Provider 组件，实现模块内部的页面数据通信。

## 小结

&emsp;这是一个根基不完善，但是勉强满足了能用就行的前端项目(也亏的很多地方只是显示表格、增删改查数据之类的基本操作)。不过从前端代码来看，不说的话，真的不确定居然会是部门级的项目。

&emsp;体会了一个集成各类模块的项目，虽然不是很好，但是可以反过来思考，想要构建好的话需要做什么。

<!-- &emsp;体会了什么是不好的管理，由此对于管理有一些思考。虽然说有上司和下属之分，但其实大家都是实现需求中的一部分，每个人要在流程中做好自己要做的事。只是上司一般相对于下属更具有主动权。而管理很糟糕的上司，使用不好自己的主动权，会对整个流程形成一种阻碍，妨碍到别人，做不好事情。这个对下属来说，就比较难受了。 -->

&emsp;这个项目也是导致我跑路的主要原因，实在受不了了。跑之前还有点纠结，结果问了一下，发现我不是第一个跑路，前端之前跑路了两个，据说后端人员更换的也很勤快，我就不纠结。如果就我一个人跑，说明我有问题，但是这么多人跑了，说明问题应该在别的地方。

<!-- &emsp;身为一个管理级别的，连个做事情的下属都没有，要自己上，结果自己还做不好，从不同业务的下属小组内调人，而且还不好好磨合，真的是不行。 -->
